<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - RUPKOTHA.COM</title>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ecf0f1;
            --main-bg: #ecf0f1;
            --content-bg: #ffffff;
            --primary-color: #3498db;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --info-color: #1abc9c;
            --font-family: 'Poppins', sans-serif;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow-x: hidden; }
        body { font-family: var(--font-family); background-color: var(--main-bg); }
        .hidden { display: none !important; }
        #admin-login { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(45deg, #34495e, #2c3e50); }
        #login-box { background: white; padding: 2.5rem; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; width: 90%; max-width: 400px; }
        #login-box h1 { margin-bottom: 1.5rem; }
        #login-box input { width: 100%; padding: 12px; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 5px; }
        #login-box button { width: 100%; padding: 12px; border: none; background: var(--primary-color); color: white; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 600; }
        #admin-auth-error { color: var(--danger-color); min-height: 1.2em; margin-bottom: 1rem; }
        #admin-app { width: 100%; height: 100%; display: flex; }
        .sidebar { width: 250px; background-color: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; padding: 1rem 0; transition: width 0.3s ease; flex-shrink: 0; }
        .sidebar-header { padding: 0 1.5rem 1.5rem 1.5rem; font-size: 1.5rem; font-weight: 700; border-bottom: 1px solid #34495e; }
        .sidebar-nav { list-style: none; margin-top: 1.5rem; flex-grow: 1; }
        .sidebar-nav a { display: flex; align-items: center; padding: 1rem 1.5rem; color: var(--sidebar-text); text-decoration: none; transition: background-color 0.2s ease; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background-color: #34495e; }
        .sidebar-nav a i { margin-right: 1rem; width: 20px; text-align: center; }
        .sidebar-footer { padding: 1.5rem; border-top: 1px solid #34495e; }
        #admin-logout-btn { background: none; border: none; color: var(--sidebar-text); font-size: 1rem; cursor: pointer; width: 100%; text-align: left; display: flex; align-items: center; }
        #admin-logout-btn i { margin-right: 1rem; }
        .main-content { flex-grow: 1; padding: 2rem; overflow-y: auto; height: 100vh; }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .content-header h1 { font-size: 2rem; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; }
        .stat-card { background: var(--content-bg); padding: 1.5rem; border-radius: 8px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 1.5rem; }
        .stat-card .icon { font-size: 2.5rem; padding: 1.2rem; border-radius: 50%; color: white; display: flex; justify-content: center; align-items: center; width: 70px; height: 70px; }
        .stat-card .icon.products { background: var(--primary-color); }
        .stat-card .icon.orders { background: var(--success-color); }
        .stat-card .icon.sales { background: var(--danger-color); }
        .stat-card .icon.coupons { background: var(--warning-color); }
        .stat-card .icon.messages { background: var(--info-color); }
        .stat-card .info h3 { font-size: 2rem; font-weight: 700; }
        .stat-card .info p { font-size: 1rem; color: #555; }
        .data-table-container { background-color: var(--content-bg); padding: 1.5rem; border-radius: 8px; box-shadow: var(--shadow); overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; white-space: nowrap; }
        .data-table th { background-color: #f4f6f8; font-weight: 600; }
        .data-table tbody tr:hover { background-color: #f9f9f9; }
        .product-thumbnail, .slider-thumbnail { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
        .action-btn { border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; color: white; font-size: 0.9rem; margin-right: 5px; }
        .btn-edit { background-color: var(--primary-color); }
        .btn-delete { background-color: var(--danger-color); }
        .btn-add { background-color: var(--success-color); color: white; border: none; padding: 10px 15px; border-radius: 5px; font-size: 1rem; cursor: pointer; }
        .btn-add i { margin-right: 0.5rem; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 100; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 8px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal-content h2 { margin-bottom: 1.5rem; }
        .modal-form { display: flex; flex-direction: column; }
        .modal-form input, .modal-form textarea, .modal-form select { width: 100%; padding: 10px; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 5px; }
        .modal-form button[type="submit"] { padding: 12px; border: none; background: var(--primary-color); color: white; border-radius: 5px; cursor: pointer; }
        .mt-2 { margin-top: 2rem; }
        .order-status-select { padding: 5px; border-radius: 5px; border: 1px solid #ddd; }
        @media (max-width: 768px) {
            #admin-app { flex-direction: column; height: auto; }
            .sidebar { width: 100%; height: auto; flex-direction: row; justify-content: space-between; align-items: center; padding: 0; border-bottom: 2px solid #34495e; }
            .sidebar-header, .sidebar-nav span, #admin-logout-btn span { display: none; }
            .sidebar-nav { margin-top: 0; display: flex; flex-grow: 1; }
            .sidebar-nav a { flex-grow: 1; justify-content: center; padding: 1rem 0.5rem; }
            .sidebar-nav a i { margin-right: 0; font-size: 1.2rem; }
            .sidebar-footer { padding: 0; border-top: none; }
            #admin-logout-btn { width: auto; padding: 1rem 1.5rem; justify-content: center; }
            #admin-logout-btn i { margin: 0; font-size: 1.2rem; }
            .main-content { padding: 1.5rem 1rem; height: auto; overflow-y: visible; width: 100%; }
            .content-header { margin-bottom: 1.5rem; flex-direction: column; align-items: flex-start; gap: 1rem; }
            .content-header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <div id="admin-login">
        <div id="login-box">
            <h1>Admin Login</h1>
            <form id="admin-login-form">
                <div id="admin-auth-error"></div>
                <input type="email" id="admin-email" placeholder="Email" required>
                <input type="password" id="admin-password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
        </div>
    </div>
    
    <div id="admin-app" class="hidden">
        <aside class="sidebar">
             <div class="sidebar-header">RUPKOTHA.COM</div>
            <ul class="sidebar-nav">
                <li><a href="#dashboard" class="nav-link active" title="Dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <li><a href="#products" class="nav-link" title="Products"><i class="fas fa-box-open"></i><span>Products</span></a></li>
                <li><a href="#orders" class="nav-link" title="Orders"><i class="fas fa-receipt"></i><span>Orders</span></a></li>
                <li><a href="#coupons" class="nav-link" title="Coupons"><i class="fas fa-tags"></i><span>Coupons</span></a></li>
                <li><a href="#slider" class="nav-link" title="Slider"><i class="fas fa-images"></i><span>Slider</span></a></li>
                <li><a href="#messages" class="nav-link" title="Messages"><i class="fas fa-envelope"></i><span>Messages</span></a></li>
            </ul>
            <div class="sidebar-footer">
                <button id="admin-logout-btn" title="Logout"><i class="fas fa-sign-out-alt"></i><span>Logout</span></button>
            </div>
        </aside>

        <main class="main-content">
            <!-- Dashboard Page -->
            <section id="dashboard" class="page-content active">
                <div class="content-header"><h1>Dashboard</h1></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="icon products"><i class="fas fa-box-open"></i></div><div class="info"><h3 id="stats-total-products">0</h3><p>Total Products</p></div></div>
                    <div class="stat-card"><div class="icon orders"><i class="fas fa-receipt"></i></div><div class="info"><h3 id="stats-total-orders">0</h3><p>Total Orders</p></div></div>
                    <div class="stat-card"><div class="icon sales"><i class="fas fa-dollar-sign"></i></div><div class="info"><h3 id="stats-total-sales">৳0</h3><p>Total Sales</p></div></div>
                    <div class="stat-card"><div class="icon messages"><i class="fas fa-envelope"></i></div><div class="info"><h3 id="stats-total-messages">0</h3><p>New Messages</p></div></div>
                </div>

                <div class="recent-orders-container mt-2">
                    <h2>Recent Orders</h2>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders-table-body">
                                <!-- Recent orders will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Products Page -->
            <section id="products" class="page-content">
                <div class="content-header">
                    <h1>Manage Products</h1>
                    <button id="add-product-btn" class="btn-add"><i class="fas fa-plus"></i> Add New Product</button>
                </div>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead><tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Offer Price</th><th>Stock</th><th>Actions</th></tr></thead>
                        <tbody id="products-table-body"></tbody>
                    </table>
                </div>
            </section>
            
             <section id="orders" class="page-content">
                <div class="content-header"><h1>Manage Orders</h1></div>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Number</th>
                                <th>Address</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body"></tbody>
                    </table>
                </div>
            </section>
             <section id="coupons" class="page-content">
                <div class="content-header"><h1>Manage Coupons</h1><button id="add-coupon-btn" class="btn-add"><i class="fas fa-plus"></i> Add New Coupon</button></div>
                <div class="data-table-container"><table class="data-table"><thead><tr><th>Code</th><th>Discount Type</th><th>Value</th><th>Actions</th></tr></thead><tbody id="coupons-table-body"></tbody></table></div>
            </section>
            <section id="slider" class="page-content">
                <div class="content-header"><h1>Manage Slider Images</h1><button id="add-slider-btn" class="btn-add"><i class="fas fa-plus"></i> Add New Image</button></div>
                <div class="data-table-container"><table class="data-table"><thead><tr><th>Image</th><th>Image URL</th><th>Actions</th></tr></thead><tbody id="slider-table-body"></tbody></table></div>
            </section>
            <section id="messages" class="page-content">
                <div class="content-header"><h1>View Messages</h1></div>
                <div class="data-table-container"><table class="data-table"><thead><tr><th>Sender</th><th>Email</th><th>Subject</th><th>Actions</th></tr></thead><tbody id="messages-table-body"></tbody></table></div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <h2 id="product-modal-title">Add Product</h2>
            <form id="product-form" class="modal-form">
                <input type="hidden" id="product-id">
                <input type="text" id="product-name" placeholder="Product Name" required>
                <input type="text" id="product-category" placeholder="Category" required>
                <input type="number" id="product-price" placeholder="Price" step="0.01" required>
                <input type="number" id="product-offer-price" placeholder="Offer Price (optional)" step="0.01">
                <input type="number" id="product-stock" placeholder="Stock Quantity" required>
                <textarea id="product-description" placeholder="Description" rows="4" required></textarea>
                <input type="url" id="product-image-url" placeholder="Image URL" required>
                <button type="submit">Save Product</button>
            </form>
        </div>
    </div>
    
    <div id="coupon-modal" class="modal">
        <div class="modal-content">
            <h2 id="coupon-modal-title">Add Coupon</h2>
            <form id="coupon-form" class="modal-form">
                <input type="hidden" id="coupon-id"><input type="text" id="coupon-code" placeholder="Coupon Code" required><select id="coupon-discount-type" required><option value="percentage">Percentage</option><option value="fixed">Fixed Amount</option></select><input type="number" id="coupon-discount-value" placeholder="Discount Value" step="0.01" required><button type="submit">Save Coupon</button>
            </form>
        </div>
    </div>

    <div id="slider-modal" class="modal">
        <div class="modal-content">
            <h2>Add Slider Image</h2>
            <form id="slider-form" class="modal-form"><input type="hidden" id="slider-id"><input type="url" id="slider-image-url" placeholder="Image URL" required><button type="submit">Save Image</button></form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getDatabase, ref, onValue, set, remove, push, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyC6jJ_XC61d9UnjOyV8BMmqjwjBlNaxCG4",
          authDomain: "rupkotha-bd-838fd.firebaseapp.com",
          databaseURL: "https://rupkotha-bd-838fd-default-rtdb.firebaseio.com",
          projectId: "rupkotha-bd-838fd",
          storageBucket: "rupkotha-bd-838fd.appspot.com",
          messagingSenderId: "482400392594",
          appId: "1:482400392594:web:316f9dadf822fef9a31d4b"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        onAuthStateChanged(auth, user => {
            if (user) {
                $('#admin-login').classList.add('hidden');
                $('#admin-app').classList.remove('hidden');
                initializeAdminPanel();
            } else {
                $('#admin-login').classList.remove('hidden');
                $('#admin-app').classList.add('hidden');
            }
        });

        $('#admin-login-form').addEventListener('submit', async e => {
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, $('#admin-email').value, $('#admin-password').value);
                $('#admin-auth-error').textContent = '';
            } catch (error) {
                $('#admin-auth-error').textContent = error.message;
            }
        });

        $('#admin-logout-btn').addEventListener('click', () => signOut(auth));

        function handleRouteChange() {
            const hash = window.location.hash || '#dashboard';
            $$('.page-content').forEach(p => p.classList.remove('active'));
            const activePage = $(hash);
            if (activePage) {
                activePage.classList.add('active');
                 if(hash === '#dashboard') {
                    updateDashboardStats();
                    loadRecentOrders();
                 }
            } else {
                $('#dashboard').classList.add('active');
                updateDashboardStats();
                loadRecentOrders();
            }
            $$('.nav-link').forEach(l => l.classList.toggle('active', l.getAttribute('href') === hash));
        }

        function initializeAdminPanel() {
            handleRouteChange();
            window.addEventListener('hashchange', handleRouteChange);
            loadProducts();
            loadCoupons();
            loadOrders();
            loadSliderImages();
            loadMessages();
            setupEventListeners();
        }

        function updateDashboardStats() {
            const ordersRef = ref(db, 'orders');
            onValue(ref(db, 'products'), s => { $('#stats-total-products').textContent = s.exists() ? Object.keys(s.val()).length : 0; }, { onlyOnce: true });
            onValue(ordersRef, s => {
                if (s.exists()) {
                    const orders = s.val();
                    const totalOrders = Object.keys(orders).length;
                    const totalSales = Object.values(orders).reduce((sum, order) => sum + order.totalAmount, 0);
                    const formattedSales = totalSales.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    
                    $('#stats-total-orders').textContent = totalOrders;
                    $('#stats-total-sales').textContent = `৳${formattedSales}`;
                } else {
                    $('#stats-total-orders').textContent = 0;
                    $('#stats-total-sales').textContent = `৳0.00`;
                }
            }, { onlyOnce: true });
            onValue(ref(db, 'coupons'), s => { $('#stats-total-coupons').textContent = s.exists() ? Object.keys(s.val()).length : 0; }, { onlyOnce: true });
            onValue(ref(db, 'messages'), s => { $('#stats-total-messages').textContent = s.exists() ? Object.keys(s.val()).length : 0; }, { onlyOnce: true });
        }
        
        function loadRecentOrders() {
            const recentOrdersQuery = query(ref(db, 'orders'), orderByChild('timestamp'), limitToLast(5));
            onValue(recentOrdersQuery, snapshot => {
                const tableBody = $('#recent-orders-table-body');
                tableBody.innerHTML = '';
                if (!snapshot.exists()) {
                    tableBody.innerHTML = '<tr><td colspan="5">No recent orders found.</td></tr>';
                    return;
                }
                const recentOrders = [];
                snapshot.forEach(child => recentOrders.push({ id: child.key, ...child.val() }));
                recentOrders.reverse().forEach(order => {
                    const orderDate = new Date(order.timestamp).toLocaleDateString();
                    const row = `
                        <tr>
                            <td>${order.orderId.slice(-6)}</td>
                            <td>${order.shippingName || 'N/A'}</td>
                            <td>${orderDate}</td>
                            <td>৳${order.totalAmount.toFixed(2)}</td>
                            <td>${order.status || 'Pending'}</td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            });
        }

        function loadProducts() {
            onValue(ref(db, 'products'), snapshot => {
                const tableBody = $('#products-table-body');
                tableBody.innerHTML = '';
                if (!snapshot.exists()) {
                    tableBody.innerHTML = '<tr><td colspan="7">No products found.</td></tr>';
                    return;
                }
                snapshot.forEach(child => {
                    const product = { id: child.key, ...child.val() };
                    const offerPriceDisplay = (product.offerPrice && product.offerPrice > 0) ? `৳${product.offerPrice}` : 'N/A';
                    const row = `
                        <tr>
                            <td><img src="${product.imageUrl}" class="product-thumbnail"></td>
                            <td>${product.name}</td>
                            <td>${product.category}</td>
                            <td>৳${product.price}</td>
                            <td>${offerPriceDisplay}</td>
                            <td>${product.stock || 0}</td>
                            <td>
                                <button class="action-btn btn-edit" data-id="${product.id}">Edit</button>
                                <button class="action-btn btn-delete" data-id="${product.id}">Delete</button>
                            </td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            });
        }
        
        function setupEventListeners() {
            $('#add-product-btn').addEventListener('click', openProductModalForCreate);
            $('#product-form').addEventListener('submit', handleProductFormSubmit);
            $('#add-coupon-btn').addEventListener('click', openCouponModalForCreate);
            $('#coupon-form').addEventListener('submit', handleCouponFormSubmit);
            $('#add-slider-btn').addEventListener('click', openSliderModal);
            $('#slider-form').addEventListener('submit', handleSliderFormSubmit);

            document.body.addEventListener('click', e => {
                if (e.target.closest('#products-table-body .btn-edit')) openProductModalForEdit(e.target.closest('.btn-edit').dataset.id);
                if (e.target.closest('#products-table-body .btn-delete')) deleteItem('products', e.target.closest('.btn-delete').dataset.id);
                if (e.target.closest('#coupons-table-body .btn-edit')) openCouponModalForEdit(e.target.closest('.btn-edit').dataset.id);
                if (e.target.closest('#coupons-table-body .btn-delete')) deleteItem('coupons', e.target.closest('.btn-delete').dataset.id);
                if (e.target.closest('#orders-table-body .btn-delete')) deleteItem('orders', e.target.closest('.btn-delete').dataset.id);
                if (e.target.closest('#slider-table-body .btn-delete')) deleteItem('sliderImages', e.target.closest('.btn-delete').dataset.id);
                if (e.target.closest('#messages-table-body .btn-delete')) deleteItem('messages', e.target.closest('.btn-delete').dataset.id);
                if (e.target.matches('.modal')) e.target.classList.remove('active');
            });
            
            document.body.addEventListener('change', e => {
                if (e.target.classList.contains('order-status-select')) {
                    const orderId = e.target.dataset.orderId;
                    const newStatus = e.target.value;
                    updateOrderStatus(orderId, newStatus);
                }
            });
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                const orderStatusRef = ref(db, `orders/${orderId}/status`);
                await set(orderStatusRef, newStatus);
            } catch (error) {
                console.error("Failed to update order status:", error);
                alert("Failed to update status. Please try again.");
            }
        }

        function openProductModalForCreate() {
            $('#product-modal-title').textContent = 'Add Product';
            $('#product-form').reset();
            $('#product-id').value = '';
            $('#product-modal').classList.add('active');
        }

        function openProductModalForEdit(productId) {
             onValue(ref(db, `products/${productId}`), snapshot => {
                if(snapshot.exists()) {
                    const product = snapshot.val();
                    $('#product-modal-title').textContent = 'Edit Product';
                    $('#product-id').value = productId;
                    $('#product-name').value = product.name;
                    $('#product-category').value = product.category;
                    $('#product-price').value = product.price;
                    $('#product-offer-price').value = product.offerPrice || '';
                    $('#product-stock').value = product.stock;
                    $('#product-description').value = product.description;
                    $('#product-image-url').value = product.imageUrl;
                    $('#product-modal').classList.add('active');
                }
             }, { onlyOnce: true });
        }
        
        async function handleProductFormSubmit(e) {
            e.preventDefault();
            const productId = $('#product-id').value;
            const productData = {
                name: $('#product-name').value,
                category: $('#product-category').value,
                price: parseFloat($('#product-price').value),
                offerPrice: parseFloat($('#product-offer-price').value) || 0,
                stock: parseInt($('#product-stock').value, 10),
                description: $('#product-description').value,
                imageUrl: $('#product-image-url').value
            };
            const dbRef = productId ? ref(db, `products/${productId}`) : push(ref(db, 'products'));
            await set(dbRef, productData);
            $('#product-modal').classList.remove('active');
        }
        
        function loadCoupons(){onValue(ref(db,'coupons'),s=>{const t=$('#coupons-table-body');if(t.innerHTML='',!s.exists())return void(t.innerHTML='<tr><td colspan="4">No coupons found.</td></tr>');s.forEach(c=>{const e={id:c.key,...c.val()},o='percentage'===e.discountType?`${e.discountValue}%`:`৳${e.discountValue}`;t.innerHTML+=`
                        <tr>
                            <td>${e.code}</td>
                            <td>${e.discountType}</td>
                            <td>${o}</td>
                            <td>
                                <button class="action-btn btn-edit" data-id="${e.id}">Edit</button>
                                <button class="action-btn btn-delete" data-id="${e.id}">Delete</button>
                            </td>
                        </tr>`})})}
        
        function loadOrders(){
            onValue(ref(db,'orders'),s=>{
                const t=$('#orders-table-body');
                if(t.innerHTML='',!s.exists()) return void(t.innerHTML='<tr><td colspan="8">No orders found.</td></tr>');
                
                let rowsHtml = '';
                s.forEach(c=>{
                    const e = {id: c.key, ...c.val()};
                    const o = new Date(e.timestamp).toLocaleDateString();
                    const currentStatus = e.status || 'Pending';
                    const statusOptions = ['Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled'];

                    let optionsHtml = statusOptions.map(status => 
                        `<option value="${status}" ${currentStatus === status ? 'selected' : ''}>${status}</option>`
                    ).join('');

                    rowsHtml +=`
                        <tr>
                            <td>${e.orderId.slice(-6)}</td>
                            <td>${e.shippingName || 'N/A'}</td>
                            <td>${e.shippingPhone || 'N/A'}</td>
                            <td>${e.shippingAddress || 'N/A'}</td>
                            <td>${o}</td>
                            <td>৳${e.totalAmount.toFixed(2)}</td>
                            <td>
                                <select class="order-status-select" data-order-id="${e.id}">
                                    ${optionsHtml}
                                </select>
                            </td>
                            <td><button class="action-btn btn-delete" data-id="${e.id}">Delete</button></td>
                        </tr>`;
                });
                t.innerHTML = rowsHtml;
            })
        }

        function loadSliderImages(){onValue(ref(db,'sliderImages'),s=>{const t=$('#slider-table-body');if(t.innerHTML='',!s.exists())return void(t.innerHTML='<tr><td colspan="3">No slider images found.</td></tr>');s.forEach(c=>{const e={id:c.key,...c.val()};t.innerHTML+=`
                        <tr>
                            <td><img src="${e.imageUrl}" class="slider-thumbnail"></td>
                            <td>${e.imageUrl}</td>
                            <td><button class="action-btn btn-delete" data-id="${e.id}">Delete</button></td>
                        </tr>`})})}
        function loadMessages(){onValue(ref(db,'messages'),s=>{const t=$('#messages-table-body');if(t.innerHTML='',!s.exists())return void(t.innerHTML='<tr><td colspan="4">No messages found.</td></tr>');s.forEach(c=>{const e={id:c.key,...c.val()};t.innerHTML+=`
                        <tr>
                            <td>${e.name}</td>
                            <td>${e.email}</td>
                            <td>${e.message.substring(0,50)}...</td>
                            <td>
                                <button class="action-btn btn-delete" data-id="${e.id}">Delete</button>
                            </td>
                        </tr>`})})}
        function openCouponModalForCreate(){$('#coupon-modal-title').textContent='Add Coupon',$('#coupon-form').reset(),$('#coupon-id').value='', $('#coupon-modal').classList.add('active')}
        function openCouponModalForEdit(s){onValue(ref(db,`coupons/${s}`),t=>{if(t.exists()){const c=t.val();$('#coupon-modal-title').textContent='Edit Coupon',$('#coupon-id').value=s,$('#coupon-code').value=c.code,$('#coupon-discount-type').value=c.discountType,$('#coupon-discount-value').value=c.discountValue,$('#coupon-modal').classList.add('active')}},{onlyOnce:!0})}
        async function handleCouponFormSubmit(s){s.preventDefault();const t=$('#coupon-id').value,c={code:$('#coupon-code').value.toUpperCase(),discountType:$('#coupon-discount-type').value,discountValue:parseFloat($('#coupon-discount-value').value)},e=t?ref(db,`coupons/${t}`):push(ref(db,'coupons'));await set(e,c),$('#coupon-modal').classList.remove('active')}
        function openSliderModal(){$('#slider-form').reset(),$('#slider-modal').classList.add('active')}
        async function handleSliderFormSubmit(s){s.preventDefault();const t={imageUrl:$('#slider-image-url').value};await set(push(ref(db,'sliderImages')),t),$('#slider-modal').classList.remove('active')}
        async function deleteItem(s,t){confirm("Are you sure you want to delete this item?")&&(await remove(ref(db,`${s}/${t}`)),alert("Item deleted."))}
    </script>
</body>
</html>